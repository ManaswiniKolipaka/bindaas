<!DOCTYPE html>

<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>Create Profile</title>
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="/foundation/stylesheets/foundation.min.css">
  <link rel="stylesheet" href="/foundation/stylesheets/app.css">

  <script src="/foundation/javascripts/modernizr.foundation.js"></script>
	
	
  
  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

</head>
<body>
 <!-- Page Layout HTML here -->

  <!-- Latest version of jQuery -->
  <script src="/foundation/javascripts/jquery.js"></script>

  <!-- Included JS Files (Unminified) -->
  <!-- [JS Files] -->
  <!-- We include all the unminified JS as well. Uncomment to use them instead -->

  <!-- Included JS Files (Minified) -->
  <script src="/foundation/javascripts/foundation.min.js"></script>

  <!-- Initialize JS Plugins -->
  <script src="/foundation/javascripts/app.js"></script>
    
  <div class="row">
    <div class="six columns">
      <h2>Bindaas</h2>
      <p><strong>Be worry free!</strong></p>
      <p>This is version <strong>2.0.0 Beta</strong></p>
      <hr />
    </div>
    <div class="six columns">
    	<ul class="inline-list">
    		<li><h6>Welcome $bindaasUser</h6></li>
    		<li><h6><a href="/dashboard/logout">logout</a></h6></li>
    	</ul>
      
    </div>
    
    
  </div>

  <div class="row">
  	<div class="two columns">
  		
  		<div class="row">
  		
  		<ul class="four side-nav">
			  <li ><a href="#">Create Workspace</a></li>
			  <li ><a href="/dashboard/$workspace/createProfile.action">Create Profile</a></li>
		</ul>	
  		</div>
  		
  	</div>
    <div class="ten columns">
    	
    	<div class="row">
    		<ul class="breadcrumbs">
  				<li><a href="/dashboard/"><strong>Dashboard</strong></a></li>
  				<li><a href="/dashboard/queryBrowser"><strong>Query Browser</strong></a></li>
  				<li><a href="/dashboard/administration/manageUserRegistration"><strong>Administration</strong></a></li>
  			</ul>
    </div>
    	<div class="row">
    		<h3 class="subheader">/Workspace:${workspace}/</h3>
    	</div>
   	 	<div class="row">
   	 		<fieldset>
    			<legend><h3>Create Profile</h3></legend>
    				<form class="custom" action="createProfile.action" method="get">
    					<input type="hidden" value="${workspace}"  name="workspace"/>
    					<input type="hidden"  name="jsonRequest"/>
    					<label>Profile Name</label>
    					<input type="text" placeholder="name" name="profileName" id="profileName"/>
    					<label for="provider">Data Provider</label>
    					<select  name="provider" id="provider">
    						<option>--- Select ---</option>
    						#foreach ($provider in $providers)
  						  <option value="$provider.getId()#$provider.getVersion()" ref="$provider.getDocumentation().get('simpleName').getAsString()" >
  						  		#if ($provider.getDocumentation().get('title'))
  						  			$provider.getDocumentation().get('title').getAsString()
  						  		#else
  						  			ID = $provider.getId() version = $provider.getVersion()
  						  		#end
  						  </option>
  						  	#end
  						  	
  						</select>
  						<br> </br>
  						<div class="panel">
  							<h6 class="subheader">Provider Description</h6>
  							<div id="providerDescription">
  								#foreach ($provider in $providers)
  									#if ($provider.getDocumentation() && $provider.getDocumentation().get('simpleName'))
  									<div id="$provider.getDocumentation().get('simpleName').getAsString()_providerDescription">
  										#if ($provider.getDocumentation().get('providerDescription'))
  											$provider.getDocumentation().get('providerDescription').getAsString()
  										#end
  									</div>
  									#end
  								#end
  								
  							</div>
  						</div>
  						<div class="panel">
  							<label for="dataSource">Data Source Configuration <a onclick="enableDataSource()">(Click to edit)</a></label>
  							<textarea name="dataSource" id="dataSource" disabled="true"></textarea>
  							<script>
  								function enableDataSource()
  								{
  									$("#dataSource").removeAttr("disabled");
  								}
  							</script>
  							
  							<div id="dataSourceContainer">
  								#foreach ($provider in $providers)
  									#if ($provider.getDocumentation() && $provider.getDocumentation().get('simpleName'))
  									<div id="$provider.getDocumentation().get('simpleName').getAsString()">
  										$provider.getDocumentation().get('dataSourceView').getAsString()
  									</div>
  									#end
  								#end
  							</div>
  							
  							
  							<script>
  							hideAllDataSources();
  							
  							$("#provider").change(function () {
		          				
		          				hideAllDataSources();
		          				showDataSource($("#provider option:selected").attr("ref"));
		          				$("#dataSource").attr("value","");
		          				
		          				});
  								function hideAllDataSources()
  								{
  									$("#dataSourceContainer > div").each ( function () {
  										$(this).addClass("hide");
  									});
  									
  									$("#providerDescription > div").each ( function () {
  										$(this).addClass("hide");
  									});
  								}
  								
  								function showDataSource(id)
  								{
  									$("#" + id).removeClass("hide");
  									$("#" + id + "_providerDescription").removeClass("hide");
  								}
  							</script>
  						</div>
  						
  						<div class="panel">
  							<h6 class="subheader">Data Source JSON Schema</h6>
  							<div id="dataSourceSchema"></div>
  						</div>
  						<input type="button" class="button" value="Submit" id="submitForm"/>
    				</form>		
    			</fieldset>
    			
    			<script>
    				$("#submitForm").ajaxError(function(e, jqxhr, settings, exception){
  										alert(exception);
						});
    				
    				$("#submitForm").click(function(){
    					
    					var jsonRequest = {};
		
						var profileName = $('#profileName').attr("value");
		
						var providerInfo = $("#provider option:selected").attr("value").split("#");
						jsonRequest.providerId = providerInfo[0];
						jsonRequest.providerVersion = providerInfo[1];
						
						try{
							jsonRequest.dataSource = jQuery.parseJSON($('#dataSource').attr("value"));
							var req = {};
							req.profileName = profileName;
							req.jsonRequest = JSON.stringify(jsonRequest,null); 
							
							$.post("/dashboard/$workspace/createProfile.action" , req , function (data){
								window.location = "/dashboard/$workspace/profile/" + profileName;
							});
							
						}catch(e){
							alert(e);
							alert("DataSource must be a valid JSON object");
						}
						
						
    				});
    			</script>
    	</div>
   	 	<div class="row">
   	 	</div>
    </div>

  </div>

  
</body>
</html>
